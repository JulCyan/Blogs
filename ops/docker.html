<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Docker | JulCyan</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="Full Stack Developer&#39; Blogs">
    
    <link rel="preload" href="/Blogs/assets/css/0.styles.27194dfd.css" as="style"><link rel="preload" href="/Blogs/assets/js/app.db3e0e22.js" as="script"><link rel="preload" href="/Blogs/assets/js/2.35186d10.js" as="script"><link rel="preload" href="/Blogs/assets/js/1.fffe7ab9.js" as="script"><link rel="preload" href="/Blogs/assets/js/31.16071b8c.js" as="script"><link rel="prefetch" href="/Blogs/assets/js/10.f25107a7.js"><link rel="prefetch" href="/Blogs/assets/js/11.30bbd869.js"><link rel="prefetch" href="/Blogs/assets/js/12.a2468d2b.js"><link rel="prefetch" href="/Blogs/assets/js/13.58ac2719.js"><link rel="prefetch" href="/Blogs/assets/js/14.1f92550b.js"><link rel="prefetch" href="/Blogs/assets/js/15.a627f94f.js"><link rel="prefetch" href="/Blogs/assets/js/16.5440ab9e.js"><link rel="prefetch" href="/Blogs/assets/js/17.77226d86.js"><link rel="prefetch" href="/Blogs/assets/js/18.50cd59ed.js"><link rel="prefetch" href="/Blogs/assets/js/19.b62f168c.js"><link rel="prefetch" href="/Blogs/assets/js/20.3fc70535.js"><link rel="prefetch" href="/Blogs/assets/js/21.871df693.js"><link rel="prefetch" href="/Blogs/assets/js/22.28d8f07e.js"><link rel="prefetch" href="/Blogs/assets/js/23.32dbe1c3.js"><link rel="prefetch" href="/Blogs/assets/js/24.1e78bc6c.js"><link rel="prefetch" href="/Blogs/assets/js/25.f542fdad.js"><link rel="prefetch" href="/Blogs/assets/js/26.5276b3e4.js"><link rel="prefetch" href="/Blogs/assets/js/27.a59a3f6b.js"><link rel="prefetch" href="/Blogs/assets/js/28.c27b07f5.js"><link rel="prefetch" href="/Blogs/assets/js/29.2cb4f680.js"><link rel="prefetch" href="/Blogs/assets/js/3.20f8d34b.js"><link rel="prefetch" href="/Blogs/assets/js/30.a59cc4b1.js"><link rel="prefetch" href="/Blogs/assets/js/32.4b22379a.js"><link rel="prefetch" href="/Blogs/assets/js/33.5b07cb45.js"><link rel="prefetch" href="/Blogs/assets/js/34.23e4fd9b.js"><link rel="prefetch" href="/Blogs/assets/js/35.5fdf0839.js"><link rel="prefetch" href="/Blogs/assets/js/36.4a0eaf53.js"><link rel="prefetch" href="/Blogs/assets/js/37.57a4e65e.js"><link rel="prefetch" href="/Blogs/assets/js/38.1b12131b.js"><link rel="prefetch" href="/Blogs/assets/js/39.1abf68d6.js"><link rel="prefetch" href="/Blogs/assets/js/4.0da7c676.js"><link rel="prefetch" href="/Blogs/assets/js/40.d5a31a65.js"><link rel="prefetch" href="/Blogs/assets/js/41.b6ff0c9d.js"><link rel="prefetch" href="/Blogs/assets/js/42.8f3d0d03.js"><link rel="prefetch" href="/Blogs/assets/js/43.3ba106c6.js"><link rel="prefetch" href="/Blogs/assets/js/44.8f9ecf3b.js"><link rel="prefetch" href="/Blogs/assets/js/45.200608ae.js"><link rel="prefetch" href="/Blogs/assets/js/46.e1bdf9f0.js"><link rel="prefetch" href="/Blogs/assets/js/47.6f4f7895.js"><link rel="prefetch" href="/Blogs/assets/js/48.55768132.js"><link rel="prefetch" href="/Blogs/assets/js/49.6620815d.js"><link rel="prefetch" href="/Blogs/assets/js/5.b8cecc7b.js"><link rel="prefetch" href="/Blogs/assets/js/50.699bf205.js"><link rel="prefetch" href="/Blogs/assets/js/6.2fcecb9b.js"><link rel="prefetch" href="/Blogs/assets/js/7.82c0cba4.js"><link rel="prefetch" href="/Blogs/assets/js/vendors~docsearch.ab6fac7c.js">
    <link rel="stylesheet" href="/Blogs/assets/css/0.styles.27194dfd.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Blogs/" class="home-link router-link-active"><!----> <span class="site-name">JulCyan</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Frontend" class="dropdown-title"><span class="title">Frontend</span> <span class="arrow down"></span></button> <button type="button" aria-label="Frontend" class="mobile-dropdown-title"><span class="title">Frontend</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Blogs/web/basics/html/" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/Blogs/web/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/Blogs/web/webpack/" class="nav-link">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/Blogs/web/node/" class="nav-link">
  Node.js
</a></li></ul></div></div><div class="nav-item"><a href="/Blogs/backend/" class="nav-link">
  Backend
</a></div><div class="nav-item"><a href="/Blogs/ops/linux.html" class="nav-link">
  OPS
</a></div><div class="nav-item"><a href="/Blogs/article/technologySelection.html" class="nav-link">
  Article
</a></div><div class="nav-item"><a href="/Blogs/repositories/" class="nav-link">
  Repositories
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Frontend" class="dropdown-title"><span class="title">Frontend</span> <span class="arrow down"></span></button> <button type="button" aria-label="Frontend" class="mobile-dropdown-title"><span class="title">Frontend</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Blogs/web/basics/html/" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/Blogs/web/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/Blogs/web/webpack/" class="nav-link">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/Blogs/web/node/" class="nav-link">
  Node.js
</a></li></ul></div></div><div class="nav-item"><a href="/Blogs/backend/" class="nav-link">
  Backend
</a></div><div class="nav-item"><a href="/Blogs/ops/linux.html" class="nav-link">
  OPS
</a></div><div class="nav-item"><a href="/Blogs/article/technologySelection.html" class="nav-link">
  Article
</a></div><div class="nav-item"><a href="/Blogs/repositories/" class="nav-link">
  Repositories
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>OPS</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Blogs/ops/linux.html" class="sidebar-link">Linux</a></li><li><a href="/Blogs/ops/docker.html" aria-current="page" class="active sidebar-link">Docker</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Blogs/ops/docker.html#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/Blogs/ops/docker.html#常用命令" class="sidebar-link">常用命令</a></li><li class="sidebar-sub-header"><a href="/Blogs/ops/docker.html#应用部署" class="sidebar-link">应用部署</a></li><li class="sidebar-sub-header"><a href="/Blogs/ops/docker.html#迁移与备份" class="sidebar-link">迁移与备份</a></li><li class="sidebar-sub-header"><a href="/Blogs/ops/docker.html#dockerfile" class="sidebar-link">Dockerfile</a></li><li class="sidebar-sub-header"><a href="/Blogs/ops/docker.html#docker-私有仓库" class="sidebar-link">Docker 私有仓库</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="docker"><a href="#docker" class="header-anchor">#</a> Docker</h1> <h2 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h2> <p><strong>centos7下</strong></p> <p>（1）yum 包更新到最新</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">sudo</span> yum update
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>（2）安装需要的软件包， yum-util 提供yum-config-manager功能，另外两个是devicemapper驱动依赖</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">sudo</span> yum <span class="token function">install</span> <span class="token parameter variable">-y</span> yum-utils device-mapper-persistent-data lvm2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>（3）设置yum源为阿里云</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">sudo</span> yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>（4）安装docker</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">sudo</span> yum <span class="token function">install</span> docker-ce
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>（5）安装后查看docker版本</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> <span class="token parameter variable">-v</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>（6）设置镜像</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">sudo</span> <span class="token function">vi</span> /etc/docker/daemon.json
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>添加内容</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token comment">// ustc</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;registry-mirrors&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;https://docker.mirrors.ustc.edu.cn&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token comment">// 或 docker 中国</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;registry-mirrors&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;https://registry.docker-cn.com&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="常用命令"><a href="#常用命令" class="header-anchor">#</a> 常用命令</h2> <p><strong>systemctl</strong>命令是系统服务管理器指令</p> <h3 id="基本命令"><a href="#基本命令" class="header-anchor">#</a> 基本命令</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>systemctl start <span class="token function">docker</span>
systemctl stop <span class="token function">docker</span>
systemctl restart <span class="token function">docker</span>
systemctl status <span class="token function">docker</span> <span class="token comment"># 查看docker状态</span>
systemctl <span class="token builtin class-name">enable</span> <span class="token function">docker</span> <span class="token comment"># 开机启动</span>
<span class="token function">docker</span> info 			<span class="token comment"># 查看docker概要信息</span>
<span class="token function">docker</span> <span class="token parameter variable">--help</span>			<span class="token comment"># 查看docker帮助文档</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="镜像相关"><a href="#镜像相关" class="header-anchor">#</a> 镜像相关</h3> <p>1）查看镜像</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> images
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>REPOSITORY：镜像名称</p> <p>TAG：镜像标签</p> <p>IMAGE ID：镜像ID</p> <p>CREATED：镜像的创建日期（不是获取该镜像的日期）</p> <p>SIZE：镜像大小</p> <p>这些镜像都是存储在Docker宿主机的/var/lib/docker目录下</p> <p>2）搜索镜像</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> search 镜像名称
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>NAME：仓库名称</p> <p>DESCRIPTION：镜像描述</p> <p>STARS：用户评价，反应一个镜像的受欢迎程度</p> <p>OFFICIAL：是否官方</p> <p>AUTOMATED：自动构建，表示该镜像由Docker Hub自动构建流程创建的</p> <p>3）其他</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> pull 镜像名称     		   	<span class="token comment"># 拉取镜像</span>
<span class="token function">docker</span> rmi  镜像ID	  				<span class="token comment"># 删除镜像</span>
<span class="token function">docker</span> rmi <span class="token variable"><span class="token variable">`</span><span class="token function">docker</span> images <span class="token parameter variable">-q</span><span class="token variable">`</span></span>    	<span class="token comment"># 删除所有镜像</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="容器相关"><a href="#容器相关" class="header-anchor">#</a> 容器相关</h3> <p><strong>1）查看容器</strong></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> <span class="token function">ps</span> 					<span class="token comment"># 查看正在运行中的容器</span>
<span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-a</span>				<span class="token comment"># 查看所有容器</span>
<span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-l</span>				<span class="token comment"># 查看最后一次运行的容器</span>
<span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-f</span> <span class="token assign-left variable">status</span><span class="token operator">=</span>exited  <span class="token comment"># 查看停止的容器</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>2）创建与启动容器</strong></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> run 		<span class="token comment"># 创建容器命令</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>创建容器常用的参数说明：</p> <p>-i：表示运行容器</p> <p>-t：表示容器启动后会进入其命令行。加入这两个参数后，容器创建就能登录进去。即分配一个伪终端</p> <p>--name :为创建的容器命名</p> <p>-v：表示目录映射关系（前者是宿主机目录，后者是映射到宿主机上的目录），可以使用多个－v做多个目录或文件映射。注意：最好做目录映射，在宿主机上做修改，然后共享到容器上</p> <p>-d：在run后面加上-d参数,则会创建一个守护式容器在后台运行（这样创建容器后不会自动登录容器，如果只加-i -t两个参数，创建后就会自动进去容器）</p> <p>-p：表示端口映射，前者是宿主机端口，后者是容器内的映射端口。可以使用多个-p做多个端口映射</p> <ul><li>交互式方式创建容器</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> run <span class="token parameter variable">-it</span> <span class="token parameter variable">--name</span><span class="token operator">=</span>容器名称 镜像名称:标签 /bin/bash

<span class="token builtin class-name">exit</span>		<span class="token comment"># 退出当前容器</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>守护式方式创建容器</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> run <span class="token parameter variable">-di</span> <span class="token parameter variable">--name</span><span class="token operator">=</span>容器名称 镜像名称:标签

<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> 容器名称 <span class="token punctuation">(</span>或者容器ID<span class="token punctuation">)</span>  /bin/bash 	<span class="token comment"># 登录守护式容器</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>重命名容器</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker rename 原容器名称 新容器名称
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>3）停止与启动容器</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker stop 容器名称（或者容器ID）	# 停止
docker start 容器名称（或者容器ID）	# 启动
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>4）文件拷贝</strong></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> <span class="token function">cp</span> 需要拷贝的文件或目录 容器名称:容器目录	<span class="token comment"># 将文件拷贝到容器内</span>
<span class="token function">docker</span> <span class="token function">cp</span> 容器名称:容器目录 需要拷贝的文件或目录	<span class="token comment"># 将文件从容器内拷贝出来</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>5）目录挂载</strong></p> <p>在创建容器的时候，将宿主机的目录与容器内的目录进行映射，这样就可以通过修改宿主机某个目录的文件从而去影响容器</p> <p>创建容器 添加-v参数 后边为   宿主机目录:容器目录</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> run <span class="token parameter variable">-di</span> <span class="token parameter variable">-v</span> /usr/local/myhtml:/usr/local/myhtml <span class="token parameter variable">--name</span><span class="token operator">=</span>mycentos3 centos:7
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如果共享的是多级的目录，可能会出现权限不足的提示</p> <p>这是因为CentOS7中的安全模块selinux把权限禁掉了，需要添加参数  --privileged=true  来解决挂载的目录没有权限的问题</p> <p><strong>6）查看容器信息</strong></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 查看容器运行的各种数据</span>
<span class="token function">docker</span> inspect 容器名称（容器ID）	
<span class="token comment"># 输出IP地址</span>
<span class="token function">docker</span> inspect <span class="token parameter variable">--format</span><span class="token operator">=</span><span class="token string">'{{.NetworkSettings.IPAddress}}'</span> 容器名称（容器ID）
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>7）删除容器</strong></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> <span class="token function">rm</span> 容器名称（容器ID）
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="应用部署"><a href="#应用部署" class="header-anchor">#</a> 应用部署</h2> <h3 id="mysql部署"><a href="#mysql部署" class="header-anchor">#</a> MySQL部署</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 拉取mysql镜像</span>
<span class="token function">docker</span> pull centos/mysql-57-centos7
<span class="token comment"># 创建容器</span>
<span class="token function">docker</span> run <span class="token parameter variable">-di</span> <span class="token parameter variable">--name</span><span class="token operator">=</span>tensquare_mysql <span class="token parameter variable">-p</span> <span class="token number">33306</span>:3306 <span class="token parameter variable">-e</span> <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token number">123456</span> mysql
<span class="token comment"># -p 代表端口映射，格式为  宿主机映射端口:容器运行端口</span>
<span class="token comment"># -e 代表添加环境变量  MYSQL_ROOT_PASSWORD  是root用户的登陆密码</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="迁移与备份"><a href="#迁移与备份" class="header-anchor">#</a> 迁移与备份</h2> <p>以容器 mynginx 为例</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 将容器保存为镜像</span>
<span class="token function">docker</span> commit mynginx mynginx_img
<span class="token comment"># 镜像备份, 将镜像保存为tar 文件</span>
<span class="token function">docker</span> save <span class="token parameter variable">-o</span> mynginx.tar mynginx_img
<span class="token comment"># 删除掉mynginx_img镜像, 然后恢复</span>
<span class="token function">docker</span> rmi mynginx_img
<span class="token function">docker</span> load <span class="token parameter variable">-i</span> mynginx.tar
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="dockerfile"><a href="#dockerfile" class="header-anchor">#</a> Dockerfile</h2> <h3 id="什么是dockerfile"><a href="#什么是dockerfile" class="header-anchor">#</a> 什么是Dockerfile</h3> <p>Dockerfile是由一系列命令和参数构成的脚本，这些命令应用于基础镜像并最终创建一个新的镜像。</p> <p>1、对于开发人员：可以为开发团队提供一个完全一致的开发环境；
2、对于测试人员：可以直接拿开发时所构建的镜像或者通过Dockerfile文件构建一个新的镜像开始工作了；
3、对于运维人员：在部署时，可以实现应用的无缝移植。</p> <h3 id="常用命令-2"><a href="#常用命令-2" class="header-anchor">#</a> 常用命令</h3> <table><thead><tr><th>命令</th> <th>作用</th></tr></thead> <tbody><tr><td>FROM image_name:tag</td> <td>定义了使用哪个基础镜像启动构建流程</td></tr> <tr><td>MAINTAINER user_name</td> <td>声明镜像的创建者</td></tr> <tr><td>ENV key value</td> <td>设置环境变量 (可以写多条)</td></tr> <tr><td>RUN command</td> <td>是Dockerfile的核心部分(可以写多条)</td></tr> <tr><td>ADD source_dir/file dest_dir/file</td> <td>将宿主机的文件复制到容器内，如果是一个压缩文件，将会在复制后自动解压</td></tr> <tr><td>COPY source_dir/file dest_dir/file</td> <td>和ADD相似，但是如果有压缩文件并不能解压</td></tr> <tr><td>WORKDIR path_dir</td> <td>设置工作目录</td></tr></tbody></table> <h3 id="使用脚本创建镜像"><a href="#使用脚本创建镜像" class="header-anchor">#</a> 使用脚本创建镜像</h3> <p>1）创建目录</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">mkdir</span> –p /usr/local/dockerjdk8
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>2）下载jdk-8u171-linux-x64.tar.gz并上传到服务器（虚拟机）中的/usr/local/dockerjdk8目录</p> <p>3）创建文件Dockerfile  <code>vi Dockerfile</code></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#依赖镜像名称和ID
FROM centos:7
#指定镜像创建者信息
MAINTAINER JulCyan
#切换工作目录
WORKDIR /usr
RUN mkdir  /usr/local/java
#ADD 是相对路径jar,把java添加到容器中
ADD jdk-8u171-linux-x64.tar.gz /usr/local/java/

#配置java环境变量
ENV JAVA_HOME /usr/local/java/jdk1.8.0_171
ENV JRE_HOME $JAVA_HOME/jre
ENV CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib:$CLASSPATH
ENV PATH $JAVA_HOME/bin:$PATH
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>4）执行命令构建镜像</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker build -t='jdk1.8' .
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>注意后边的空格和点，不要省略</p> <p>5）查看镜像是否建立完成</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker images
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="docker-私有仓库"><a href="#docker-私有仓库" class="header-anchor">#</a> Docker 私有仓库</h2> <h3 id="私有仓库搭建与配置"><a href="#私有仓库搭建与配置" class="header-anchor">#</a> 私有仓库搭建与配置</h3> <p>1）拉取私有仓库镜像（此步省略）</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker pull registry
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>2）启动私有仓库容器</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker run -di --name=registry -p 5000:5000 registry
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>3）假设虚拟机静态ip 为<code>192.168.23.129</code></p> <p>访问 http://192.168.23.129:5000/v2/_catalog 看到<code>{&quot;repositories&quot;:[]}</code> 表示私有仓库搭成功并且内容为空</p> <p>4）修改daemon.json</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">sudo</span> <span class="token function">vi</span> /etc/docker/daemon.json
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>添加以下内容，保存退出。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span><span class="token property">&quot;insecure-registries&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;192.168.23.129:5000&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>此步用于让 docker信任私有仓库地址</p> <p>5）重启docker 服务</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>systemctl restart <span class="token function">docker</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="镜像上传至私有仓库"><a href="#镜像上传至私有仓库" class="header-anchor">#</a> 镜像上传至私有仓库</h3> <p>1）标记此镜像为私有仓库的镜像</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># tag 镜像名格式为 remotehost/[命令空间]/仓库名</span>
<span class="token function">docker</span> tag jdk1.8 <span class="token number">192.168</span>.23.129:5000/jdk1.8
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>2）再次启动私服容器</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker start registry
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>3）上传标记的镜像</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker push 192.168.23.129:5000/jdk1.8
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Blogs/ops/linux.html" class="prev">
        Linux
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/Blogs/assets/js/app.db3e0e22.js" defer></script><script src="/Blogs/assets/js/2.35186d10.js" defer></script><script src="/Blogs/assets/js/1.fffe7ab9.js" defer></script><script src="/Blogs/assets/js/31.16071b8c.js" defer></script>
  </body>
</html>
